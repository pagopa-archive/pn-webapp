<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <title>Hello, CDN!</title>
    <meta name="description" content="Hello CDN">
    <meta name="API-GW" content="${API_GW_BASE_URL}">
    <script src="js/jquery-3.6.0.slim.min.js"
		integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
		crossorigin="anonymous">
    </script>
</head>
<body>
    <p>Hello CDN</p>
    <p>
        Fill<br>
        the api-key secret <input type="password" id="API-Key" value="" />,<br>
        the PA id <input type="text" id="paId" value="" /><br>
        and the protocol number <input type="text" id="paNotificationId" value="" /><br>
    </p>
    <p>
        Then
        <button id="btn">Call API-GW</button>
    </p>
    <div id="output">

    </div>
</body>
<script>

async function getHello() {
    let url = jQuery('meta[name="API-GW"]').attr('content') + '/delivery/notifications/sent'
    let apiKey = jQuery('#API-Key').val()
    let paId = jQuery('#paId').val()
    let paNotificationId = jQuery('#paNotificationId').val()

    let response = await fetch( url, {
        method: 'POST',
        cache: 'no-cache',
        headers: {
            'x-api-key': apiKey,
            'X-PagoPA-PN-PA': paId,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            paNotificationId: paNotificationId,
            subject: "Hello World",
            cancelledIun: null,
            recipients: [{
                fc: "CodiceFiscale",
                digitalDomicile: {
                    type: "PEC",
                    address: "hello@world"
                },
                physicalAddress: {
                    at: "string",
                    address: "string",
                    addressDetails: "string",
                    zip: "string",
                    municipality: "string",
                    province: "string"
                }
            }],
            documents: [{
                digests: {
                    sha256: "string"
                },
                contentType: "string",
                body: "aXMgc2ltcGx5IGR1bW15IHRleHQgb2YgdGhlIHByaW50aW5nIGFuZCB0eXBlc2V0dGluZyBpbmR1c3RyeS4gTG9yZW0gSXBzdW0gaGFzIGJlZW4gdGhlIGluZHVzdHJ5J3Mgc3RhbmRhcmQgZHVtbXkgdGV4dCBldmVyIHNpbmNlIHRoZSAxNTAwcywgd2hlbiBhbiB1bmtub3duIHByaW50ZXIgdG9vayBhIGdhbGxleSBvZiB0eXBlIGFuZCBzY3JhbWJsZWQgaXQgdG8gbWFrZSBhIHR5cGUgc3BlY2ltZW4gYm9vay4gSXQgaGFzIHN1cnZpdmVkIG5vdCBvbmx5IGZpdmUgY2VudHVyaWVzLCBidXQgYWxzbyB0aGUgbGVhcCBpbnRvIGVsZWN0cm9uaWMgdHlwZXNldHRpbmcsIHJlbWFpbmluZyBlc3NlbnRpYWxseSB1bmNoYW5nZWQuIEl0IHdhcyBwb3B1bGFyaXNlZCBpbiB0aGUgMTk2MHMgd2l0aCB0aGUgcmVsZWFzZSBvZiBMZXRyYXNldCBzaGVldHMgY29udGFpbmluZyBMb3JlbSBJcHN1bSBwYXNzYWdlcywgYW5kIG1vcmUgcmVjZW50bHkgd2l0aCBkZXNrdG9wIHB1Ymxpc2hpbmcgc29mdHdhcmUgbGlrZSBBbGR1cyBQYWdlTWFrZXIgaW5jbHVkaW5nIHZlcnNpb25zIG9mIExvcmVtIElwc3VtLg=="
            }]
        })
    });

    let json = await response.json();
    return json;
}


jQuery(() => {
    jQuery('#btn').click( (evt) => {
        getHello().then( msg => {
            jQuery('#output').prepend( '<pre>'+ JSON.stringify(msg) + '</pre>\n' )
        })
    });
})
</script>
</html>
